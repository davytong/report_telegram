<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Telegram Photo Report</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<style>
  body {
    font-family:'khmer os siemreap','Roboto',Arial,sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:20px;
    color:#333;
  }

  /* CENTER EVERYTHING */
  .container {
    max-width: 900px;
    margin: auto;
  }

  header {
    text-align:center;
    margin-bottom:20px;
  }

  header img {
    width:100px;
    height:auto;
    margin-bottom:10px;
    border-radius:5px;
  }

  header h1 {
    font-size:24px;
    color:#2f3d88;
    margin:5px 0;
  }

  header h5 {
    font-size:18px;
    color:#2f3d88;
    margin:0;
    font-family:'Khmer OS Moul Light',Arial,sans-serif;
    font-weight:400;
  }

  #generatedDate {
    color:#e74c3c;
    font-size:13px;
    font-weight:500;
  }

  label {
    display:block;
    margin:15px auto 5px;
    font-weight:500;
    text-align:center;
  }

  select {
    display:block;
    width:250px;
    margin:0 auto 15px;
    padding:8px 12px;
    font-size:14px;
    border-radius:6px;
    border:1px solid #ccc;
    cursor:pointer;
    transition:0.2s;
  }

  select:hover, select:focus {
    border-color:#2f3d88;
    box-shadow:0 0 5px rgba(47,61,136,0.3);
  }

  /* TABLE WRAPPER CENTER FIX */
  .table-wrapper {
    max-width: 900px;
    margin: auto;
  }

  table {
    width:100%;
    border-collapse:collapse;
    background:white;
    border-radius:6px;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
  }

  th, td {
    padding:12px;
    text-align:center;
    border:1px solid lightskyblue;
    vertical-align:middle;
  }

  th {
    background:linear-gradient(90deg,#2f3d88,#3b5edb);
    color:white;
    font-weight:500;
  }

  tr:nth-child(even) {
    background:#f7f7f7;
  }

  img {
    width:120px;
    height:auto;
    border-radius:8px;
  }

  /* ---------- PRINT MODE ---------- */
  @media print {
    body {
      background:white;
      padding:0;
      color:#000;
      font-size:12pt;
    }

    label, select {
      display:none;
    }

    table {
      width:100%;
      border:1px solid #000;
      box-shadow:none;
    }

    th, td {
      border:1px solid #000;
      padding:6px;
    }

    img {
      width:150px;
      height:auto;
    }
  }

  /* ---------- MOBILE RESPONSIVE (CARD STYLE DROPDOWN) ---------- */
  @media screen and (max-width: 600px) {

    .container, .table-wrapper {
      width: 100%;
      margin: 0 auto;
      padding: 0;



    }

    table, thead, tbody, th, td, tr {
      width:100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
      /* border-bottom: 1px solid #ddd; */
      /* box-shadow:0 1px 4px rgba(0,0,0,0.1); */
      /* border: none; */
    }

    thead {
      display:none;
    }
    tr {
      margin-bottom:15px;
      padding:10px;
      background:#fff;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      border-radius:8px;
    }

    td {
      padding:8px 10px;
      text-align:left;
      position:relative;
    }

    td:before {
      content:attr(data-label);
      font-weight:bold;
      color:#2f3d88;
      display:block;
      margin-bottom:3px;
    }

    img {
      width:100%;
      max-width:250px;
      height:auto;
      display:block;
      margin:0 auto 10px;
      border-radius:8px;
    }

    select {
      width:90%;
      max-width:350px;
    }
  }
</style>
</head>

<body>

<div class="container">

<header>
  <img src="https://belteigroup.com.kh/images/beltei_university_Press.jpg" alt="Logo">
  <h5>ប៊ែលធី ស្រាវជ្រាវ និងបោះពុម្ព</h5>
  <h1>BELTEI University Press</h1>
  <p>Generated on: <span id="generatedDate"></span></p>
</header>

<label for="groupFilter">Select Group:</label>
<select id="groupFilter">
  <option value="">All Groups</option>
</select>

<div class="table-wrapper">
<table id="report">
  <thead>
    <tr>
      <th>Photo</th>
      <th>Sender</th>
      <th>Caption</th>
      <th>Date/Time</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

</div> <!-- /container -->

<script>
$(document).ready(function() {

  $('#generatedDate').text(new Date().toLocaleString());

  const groupNames = {};

  function loadGroups() {
    $.getJSON('/api/groups', function(groups) {
      $.each(groups, function(i, g) {
        $('#groupFilter').append(`<option value="${g.id}">${g.name}</option>`);
        groupNames[g.id] = g.name;
      });
      loadReport();
    });
  }

  function loadReport() {
    const groupId = $('#groupFilter').val();

    $.getJSON(`/api/images?group_id=${groupId}`, function(data) {
      const tbody = $('#report tbody');
      tbody.empty();

      $.each(data, function(i, img) {
        tbody.append(`
          <tr>
            <td data-label="Photo"><img src="${img.url}" /></td>
            <td data-label="Sender">${img.sender}</td>
            <td data-label="Caption">${img.caption}</td>
            <td data-label="Date/Time">${new Date(img.created_at).toLocaleString()}</td>
          </tr>
        `);
      });
    });
  }

  $('#groupFilter').change(loadReport);

  loadGroups();
});
</script>

</body>
</html>
